---
layout: post
title: "ğŸ›  Lá»—i VPN Site2Site do lá»—i MTU máº·c Ä‘á»‹nh cá»§a thiáº¿t bá»‹"
date: 2024-01-21 04:47:00.000000000 -08:00
type: post
parent_id: '0'
published: true
status: publish
categories:
- IT
- Network
tags:
- tshoot
- vpn
- mtu
author: thu4nvd
permalink: "/vpn-s2s-mtu/"
---

# VPN site to site OpenVPN lá»—i káº¿t ná»‘i trÃªn Draytek 2925fn
*Use 2-3 secondary keywords in the description.*

## Summary (Optional, especially when the article is short)

Chia sáº» cho anh em 1 trÆ°á»ng há»£p hÆ¡i bá»‹ chua trong kia sá»­ dá»¥ng VPN site to site.
TrÆ°á»›c Ä‘Ã¢y mÃ¬nh cÃ³ chia sáº» vá» cÃ¡ch thá»©c VPN S2S dÃ¹ng openVPN, nÃ³ váº«n cháº¡y cá»±c ká»³ á»•n Ä‘á»‹nh Ä‘áº¿n khi bÃªn mÃ¬nh quyáº¿t Ä‘á»‹nh kÃ©o 1 Ä‘Æ°á»ng leased line cho video conference.
BÃªn nhÃ  cung cáº¥p Ä‘Æ°a cho mÃ¬nh con Draytek 2925fn chá»‰ Ä‘á»ƒ lÃ m router vÃ¬ mÃ¬nh Ä‘Ã£ cÃ³ firewall rá»“i. Báº¯t Ä‘áº§u chuyá»ƒn VPN S2S thÃ´ng qua Ä‘Æ°á»ng má»›i má»i thá»© trong ráº¥t á»•n cho Ä‘áº¿n khi remote site ko thá»ƒ káº¿t ná»‘i tá»›i báº¥t cá»© dá»‹ch vá»¥ nÃ o mÃ  cÃ³ SSL bÃªn trong internal.

## Symptom

Ping vÃ  check gÃ³i TCP hoÃ n toÃ n bÃ¬nh thÆ°á»ng, nhÆ°ng khÃ´ng cÃ¡ch nÃ o query Ä‘Æ°á»£c data.

## Cause
* *What causes this problem.*

## Solution

* Tá»›i Ä‘Ã¢y ta biáº¿t ráº±ng gÃ³i tin Ä‘i qua 2 site lÃ  á»•n, giá» mÃ¬nh sáº½ tiáº¿n tá»›i layer cao hÆ¡n (layer 4).
Kiá»ƒm tra káº¿t ná»‘i SSL báº±ng cÃ¢u lá»‡nh.

```bash
# openssl s_client -connect <server>:636 -debug < /dev/null
```
TrÆ°á»ng há»£p káº¿t ná»‘i bÃ¬nh thÆ°á»ng thÃ¬ báº¡n sáº½ tháº¥y nhÆ° trong hÃ¬nh mÃ  mÃ¬nh Ä‘Ã£ attached.

![openssl_connect](https://scontent-hkg1-1.xx.fbcdn.net/v/t39.30808-6/420114436_7909220212426610_552741997734043254_n.jpg?_nc_cat=101&ccb=1-7&_nc_sid=c42490&_nc_eui2=AeFNCHfpgNsjS0s_48ORPN5qZWYQuOwRU7llZhC47BFTucgt-8HXwUVAlPPlKsVx1fdAf4iAYzYicyS8TyeGJn4M&_nc_ohc=hGLy0_iwMUEAX-t4_rE&_nc_ht=scontent-hkg1-1.xx&oh=00_AfA3oJr4cvgetRdz6xdbX7CdKwPS6E4LWBtKEs-zqHxOlg&oe=65B2C4DE)

TrÆ°á»ng há»£p fail thÃ¬ cÃ¢u lá»‡nh sáº½ treo á»Ÿ line 0140.
Äá»‘i vá»›i trÆ°á»ng há»£p fail thÃ¬ server sáº½ return error vÃ  ko cÃ³ káº¿t quáº£ nÃ o tráº£ vá», cáº£ dá»‹ch vá»¥ lá»—i háº¿t.
Vui nháº¥t lÃ  náº¿u Ä‘á»•i con router tá»« Virgor 2925fn sang Vigor 2960 thÃ¬ hoÃ n toÃ n khÃ´ng bá»‹.
Tá»›i Ä‘Ã¢y thÃ¬ mÃ¬nh ngÃ¢m cá»©u thÃ¬ phÃ¡t hiá»‡n ra lÃ  con 2925 nÃ³ cÃ³ cáº¯t bá»›t byte trÃªn MTU nÃªn gÃ¢y ra tÃ¬nh tráº¡ng trÃªn.
Tá»›i Ä‘Ã¢y thÃ¬ Ä‘Ã£ biáº¿t nguyÃªn nhÃ¢n lÃ  gÃ¬, bÆ°á»›c káº¿ tiáº¿p lÃ  kiá»ƒm tra con sá»‘ MTU.

```bash
# ping -s <MTU number> -c 10 <internal server>
```

Sau má»™t há»“i thÃ¬ mÃ¬nh ra Ä‘Æ°á»£c con sá»‘ lÃ  1358, tá»›i Ä‘Ã¢y thÃ¬ mÃ¬nh thiáº¿t láº­p thÃªm 2 options vÃ o openVPN server.
```
tun-mtu 1358;
mssfix 1358;
```
Sau Ä‘Ã³ chá»‰ cáº§n restart láº¡i openVPN server.
Cuá»‘i cÃ¹ng thÃ¬ test SSL tá»« remote server vÃ o internal server.
MÃ¬nh thÃ nh cÃ´ng trong viá»‡c káº¿t ná»‘i service tá»« remote vÃ o internal. SLL tráº£ vá» nhÆ° mong muá»‘n.


## Reference  

Facebook Group (https://www.facebook.com/groups/labccnaccnpfirewall)

